# 体育博彩平台前端产品交互文档

**文档版本**: 1.0  
**更新日期**: 2025-12-26  
**作者**: Manus AI

---

## 目录

1. [概述](#1-概述)
2. [核心设计原则](#2-核心设计原则)
3. [功能模块详解](#3-功能模块详解)
    - 3.1. [比赛导航 (Match Navigation)](#31-比赛导航-match-navigation)
    - 3.2. [比赛列表 (Match List)](#32-比赛列表-match-list)
    - 3.3. [比赛详情页 (Match Details)](#33-比赛详情页-match-details)
    - 3.4. [盘口展示与分类 (Market Display & Classification)](#34-盘口展示与分类-market-display--classification)
    - 3.5. [投注单交互 (Bet Slip Interaction)](#35-投注单交互-bet-slip-interaction)
4. [数据状态与UI映射](#4-数据状态与ui映射)
5. [WebSocket实时通信](#5-websocket实时通信)
6. [API集成策略](#6-api集成策略)
7. [参考资料](#7-参考资料)

---

## 1. 概述

本文档旨在为体育博彩平台的前端开发提供一份全面的产品交互设计方案。方案整合了后端API的技术约束、盘口分类的业务逻辑，以及先进的交互设计理念，目标是打造一个既能满足新手用户轻松上手的需求，又能为资深玩家提供足够策略深度和操作效率的顶级平台。

本文档将详细阐述从比赛导航到最终投注的完整用户流程，重点聚焦于**比赛导航**、**盘口展示**、以及创新的**投注单交互模式**。

---

## 2. 核心设计原则

平台交互设计遵循以下核心原则，旨在平衡简洁性与功能性：

| 原则 | 描述 |
| :--- | :--- |
| **渐进式复杂性** | 默认界面保持简洁直观，将高级功能和复杂操作收敛至特定场景和核心组件（如投注单）中，避免信息过载。 |
| **响应式与实时性** | 界面需能高效处理并展示通过 WebSocket 实时推送的数据，如赔率变化、比赛状态更新等，确保信息的即时性。 |
| **内存优化** | 前端实现必须严格遵循内存管理最佳实践，特别是在处理大规模列表数据时，避免因数据累积导致客户端性能下降。 |
| **策略支持** | 交互流程应支持用户的策略性投注行为，如风险对冲、赔率监控和复杂的过关组合。 |

---

## 3. 功能模块详解

### 3.1. 比赛导航 (Match Navigation)

比赛导航采用三级联动结构，引导用户快速筛选至目标赛事。导航栏应常驻于页面左侧或顶部，提供清晰的层级关系。

| 导航层级 | 功能描述 | API 接口 | 实现要点 |
| :--- | :--- | :--- | :--- |
| **一级：体育项目** | 展示所有支持的体育项目列表，如足球、篮球、电竞等。 | `/v1/menu/sports` | 列表应默认加载，并可折叠/展开。 |
| **二级：国家/赛区** | 用户选择体育项目后，展示对应的国家或赛区列表。 | `/v1/menu/category` | 需传入 `sport_id`。此层级可与热门联赛（`hot_tournament`）结合展示。 |
| **三级：联赛/锦标赛** | 用户选择赛区后，展示该赛区下的所有联赛。 | `/v1/menu/tournament` | 需传入 `cate_id`。点击联赛后，右侧主内容区将加载对应的比赛列表。 |

导航的同时，页面顶部应提供一个**面包屑导航**，清晰地展示用户当前所在的路径（体育 > 赛区 > 联赛），并允许快速返回上级。该功能通过 `/v1/menu/breadcrumb` 接口实现。

---

### 3.2. 比赛列表 (Match List)

比赛列表是平台的核心展示区域，用于呈现符合用户筛选条件的赛事信息。

#### 3.2.1. 数据获取与内存管理

通过调用 `/v1/match` 接口获取比赛列表。该接口支持按体育项目、联赛、比赛状态（滚球/赛前）等多种条件进行筛选。

> **关键实现要点**: `/v1/match` 接口返回的 `markets` 字段会包含大量数据。前端在获取到比赛列表后，**应立即清空每个比赛对象中的 `markets` 数组，并手动触发垃圾回收以释放内存**。盘口数据将在用户进入比赛详情页时通过 `/v1/match/row/{match_id}` 接口按需加载。

#### 3.2.2. 比赛条目信息展示

每个比赛条目应清晰展示以下核心信息：

| 信息项 | 数据来源字段 | 展示说明 |
| :--- | :--- | :--- |
| 开赛时间 | `start_time` | 格式化为本地时间，如 "12-26 20:00"。 |
| 比赛状态 | `status` | 参见下方状态映射表。 |
| 对阵双方 | `home_competitor`, `away_competitor` | 展示队名（`name`）和队徽（`logo`）。 |
| 实时比分 | `home_competitor.score`, `away_competitor.score` | 仅滚球比赛显示。 |
| 滚球标识 | `product` (specifier内) | 若 `product=1`，需在显著位置标注 **"Live"** 或 **"滚球"** 标识。 |

#### 3.2.3. 交互行为

点击任意比赛条目，将导航至该比赛的详情页。

---

### 3.3. 比赛详情页 (Match Details)

比赛详情页是用户研究盘口和进行投注决策的主要场所。

#### 3.3.1. 页面结构

页面顶部为比赛的 **Header** 信息，包含对阵双方、实时比分、比赛时间、比赛状态等，通过 `/v1/match/{match_id}` 接口获取。页面主体为**盘口列表**。

#### 3.3.2. 盘口数据加载

进入详情页后，通过 `/v1/match/row/{match_id}` 接口获取该场比赛的**所有盘口数据**。此接口取代了列表页中的 `markets` 数据，确保用户获取的是最新、最全的盘口信息。对于盘口数量较多的比赛，也可使用 `/v1/match/{match_id}/market` 接口进行分页加载。

---

### 3.4. 盘口展示与分类 (Market Display & Classification)

为了使用户能够高效地在众多盘口中进行导航和筛选，平台采用 **Tab & Chip** 两级分类系统。

#### 3.4.1. 分类逻辑

所有盘口数据在前端获取后，需根据《体育盘口Tab&Chip分类规则文档》中定义的算法进行处理，为每个 `market` 对象动态分配 `tab_id` 和 `chip_id`。分配遵循三层优先级：

```
优先级 1: Groups 字段 → 优先级 2: Specifiers 字段 → 优先级 3: 默认分配（"流行"）
```

#### 3.4.2. Tab (一级分类)

页面主体内容区以 Tab 标签页的形式展示一级分类。不同运动的 Tab 分类有所不同：

**足球 Tab 分类**:

| Tab 名称 | 说明 | 常见盘口 |
| :--- | :--- | :--- |
| **流行** | 最常见的盘口，包括基础投注 | 1X2、让球、大小球 |
| **进球** | 与进球相关的所有盘口 | 进球数、进球者、首进球者 |
| **统计信息** | 比赛统计数据相关 | 角球数、黄牌数、射门数 |
| **球员** | 球员个人表现相关 | 球员进球、球员助攻 |
| **角球** | 角球相关盘口 | 角球总数、角球大小 |
| **黄牌** | 黄牌相关盘口 | 黄牌总数、黄牌大小 |
| **组合** | 多个条件组合 | 半全场、进球+大小球 |
| **上半场** | 上半场专属盘口 | 上半场1X2、上半场大小球 |
| **下半场** | 下半场专属盘口 | 下半场1X2、下半场大小球 |

**篮球 Tab 分类**:

| Tab 名称 | 说明 | 常见盘口 |
| :--- | :--- | :--- |
| **流行** | 最常见的盘口 | 胜负、让分、大小分 |
| **玩家积分** | 球员个人得分相关 | 球员得分、球员得分大小 |
| **3分** | 三分球相关盘口 | 三分球总数、三分球大小 |
| **关键传球** | 助攻相关盘口 | 总助攻数、助攻大小 |
| **四分之一决赛** | 按节分类的盘口 | 单节胜负、单节大小分 |
| **上半场** | 上半场专属盘口 | 上半场胜负、上半场大小分 |

#### 3.4.3. Chip (二级分类)

在每个 Tab 内容区的顶部，使用 Chip 标签的形式展示二级分类。例如，在"四分之一决赛"Tab下，会显示"第1节"、"第2节"等 Chips。用户点击 Chip 可筛选出该节对应的盘口。

Chip ID 的生成规则为：`{tab_id}_{specifier_name}_{specifier_value}`

**示例**:
```
Tab: "四分之一决赛"
Specifier: "quarternr=1"
→ Chip ID = "四分之一决赛_quarternr_1" (显示为"第1节")
```

#### 3.4.4. 盘口卡片 (Market Card)

盘口卡片是展示具体投注选项的基本单元：

- 每个 **Market ID** 对应一张独立的盘口卡片。
- 卡片头部展示盘口名称（`name`）。
- 卡片内，每个 **Specifier** 组合（如 `quarternr=1|hcp=-1.5`）代表一行可投注的选项。
- 每行展示具体的投注项（Outcomes）及其赔率。
- 若该盘口的 `product=1`，卡片需标注 **"Live"** 标识。

**盘口卡片结构示意**:

```
┌─────────────────────────────────────────────────┐
│ [Live] 让分盘 (Handicap)                        │
├─────────────────────────────────────────────────┤
│ hcp=-1.5  │ 主队 -1.5 @ 1.85 │ 客队 +1.5 @ 1.95 │
│ hcp=-2.5  │ 主队 -2.5 @ 2.10 │ 客队 +2.5 @ 1.70 │
│ hcp=-3.5  │ 主队 -3.5 @ 2.45 │ 客队 +3.5 @ 1.55 │
└─────────────────────────────────────────────────┘
```

---

### 3.5. 投注单交互 (Bet Slip Interaction) - V2.0

投注单是实现高级投注策略的核心，其交互设计严格遵循《体育博彩平台盘口交互设计方案》中定义的原则，并根据最新需求进行迭代。本章节将详细定义投注单的各项交互逻辑和功能。

投注单是实现高级投注策略的核心，其交互设计严格遵循《体育博彩平台盘口交互设计方案》中定义的原则。

#### 3.5.1. 基础交互与模式切换

在盘口列表中，点击任意赔率选项，该选项即被添加至投注单。投注单包含两种主要模式：**单关 (Single)** 和 **串关 (Parlay)**，用户可以通过顶部的 Tab 切换。

- **单关模式**: 每个投注选项独立计算金额和赔付。
- **串关模式**: 多个投注选项组合成一个注单，所有选项必须全部猜中才能获胜。

#### 3.5.2. 投注单状态与信息展示

投注单内的每个选项都需要清晰地反映其状态，并提供明确的交互反馈。

| 状态 | UI 表现与交互逻辑 |
| :--- | :--- |
| **锁盘/失效** | 选项背景变灰，赔率消失，显示“已锁盘”或“已失效”图标。该选项无法被投注，若包含在串关中，整个串关无法投注。 |
| **串关冲突** | 在串关模式下，如果用户添加了来自**同一场比赛**的多个盘口，系统需在投注单顶部或冲突选项旁明确提示“**同一比赛的盘口无法串关**”，并禁用“下注”按钮。 |
| **赔率变化** | 赔率更新时，背景高亮（绿色代表赔率升高，红色代表降低），持续2-3秒后恢复正常。 |
| **投注中** | 见 [3.5.5. 投注生命周期](#355-投注生命周期)。 |
| **投注失败** | 见 [3.5.6. 投注拒绝与打回处理](#356-投注拒绝与打回处理)。 |

#### 3.5.3. 金额输入逻辑

- **单关模式**: 每个投注选项卡片都拥有一个独立的金额输入框。
- **串关模式**: 所有投注选项下方只有一个全局的金额输入框，用于输入整个串关的投注额。

#### 3.5.4. 接受赔率变化设置

投注单需提供一个全局设置项，允许用户预设如何处理在下注确认期间发生的赔率变化。此设置通常以一个下拉菜单或一组选项按钮的形式存在。

| 设置选项 | 描述 | 处理逻辑 |
| :--- | :--- | :--- |
| **不接受任何赔率变化** | 赔率有任何变动（升高或降低），投注都将被拒绝。 | 如果赔率变化，投注请求失败并打回。 |
| **接受任何赔率变化** | 无论赔率如何变动，都按最新的赔率进行投注。 | 系统自动接受新赔率并继续处理投注。 |
| **只接受更高赔率** | 只有当赔率升高或不变时才接受投注，赔率降低则拒绝。 | 如果赔率降低，投注请求失败并打回；如果升高或不变，则接受。 |

#### 3.5.5. 投注生命周期：等待与处理

用户点击“下注”按钮后，注单进入一个短暂的等待和处理周期。

- **等待时间**: 赛前盘为 0-3 秒，滚球盘为 0-16 秒。这是一个模拟的服务器处理时间。
- **投注中状态**: 
  - 在此期间，投注单**可以继续添加新盘口**，但“下注”按钮会变为全局禁用状态，防止重复提交。
  - 已提交的注单（或注单组合）应进入“投注中”状态，UI上显示加载动画，并且**无法修改金额或移除**。
- **悬浮窗设计 (建议)**: 
  - 为了不阻塞用户继续添加新盘口，可以将“投注中”的注单从主投注单列表中移除，放入一个侧边悬浮窗。
  - 悬浮窗默认收起，仅显示“投注中...”和一个加载动画。
  - 用户悬浮或点击时，展开显示正在处理中的注单卡片列表。

#### 3.5.6. 投注拒绝与打回处理

如果投注因任何原因（如赔率变化、盘口关闭、模拟的随机拒绝等）被服务器拒绝，前端需要进行优雅处理。

1. **明确提示**: 在投注单顶部或悬浮窗内显示明确的拒绝原因，例如“赔率已变更，投注失败”或“盘口已关闭”。
2. **注单返回**: 之前提交失败的注单应**自动返回**到主投注单列表中。
3. **视觉引导**: 返回的注单应有高亮或动画效果，吸引用户注意。
4. **冲突处理**: 如果返回的注单与投注单中已存在的选项冲突（例如，用户在等待期间又添加了同一个选项），系统应自动合并，避免重复显示。

#### 3.5.7. 新增功能：高级过关模式

在“串关”模式的基础上，增加更复杂的过关玩法。

##### a. Custom Bet

- **功能**: 允许用户将**同一盘口**的多个选项合并为一个逻辑整体（“或”关系），作为一个特殊的“Way”参与过关。
- **交互**: 当用户在串关模式下添加了来自同一盘口的多个选项时，在该投注卡片上出现一个“合并选项”按钮。点击后，这几个选项在视觉上合并，并被视为过关计算中的一个单位。

##### b. 系统过关 (System Bet)

- **功能**: 当投注单中的选项数量 ≥ 3 时，在“串关”模式 Tab 旁边出现一个新的“系统过关” Tab。
- **交互**: 
  - 此 Tab 内会根据选项数量自动生成所有可能的系统过关方案。例如，有4个选项（A, B, C, D），则会提供“2/4”（6注）、“3/4”（4注）等方案。
  - 用户可以为每种方案独立输入投注金额。

##### c. Banker (胆码)

- **功能**: 在“系统过关”模式下，允许用户将一个或多个选项设定为“Banker”。
- **交互**: 
  - 每个选项卡片上提供一个“B”或“设为胆码”的开关。
  - 设定 Banker 后，系统过关的组合将变为：**所有组合都必须包含 Banker**。例如，4个选项（A, B, C, D），如果 A 是 Banker，则“2/3”的系统过关（从B,C,D中选）将变为 A + (B+C), A + (B+D), A + (C+D)。

---

## 4. 数据状态与UI映射

### 4.1. 比赛状态 (Match Status)

| 状态码 | 状态名称 | UI 表现 |
| :--- | :--- | :--- |
| 0 | Not Started | 显示开赛时间，可投注。 |
| 1 | Live | 显示 **"Live"** 标识，实时比分，可投注。 |
| 2 | Suspended | 显示 "暂停" 标识，暂停投注。 |
| 3 | Ended | 显示 "已结束"，不可投注。 |
| 4 | Closed | 隐藏或显示 "已关闭"，不可投注。 |
| 5 | Cancelled | 显示 "已取消"，不可投注。 |
| 6 | Delayed | 显示 "延迟"，暂停投注。 |
| 7 | Interrupted | 显示 "中断"，暂停投注。 |
| 8 | Postponed | 显示 "推迟"，不可投注。 |
| 9 | Abandoned | 显示 "弃赛"，不可投注。 |

### 4.2. Specifier 状态 (Specifier Status)

| 状态码 | 状态名称 | UI 表现 |
| :--- | :--- | :--- |
| 1 | Active | 正常显示赔率，**接受投注**。 |
| -1 | Suspended | 显示赔率，但按钮置灰，**不接受投注**。 |
| 0 | Deactivated | **隐藏该行**或显示 "暂停"，不接受投注。 |
| -2 | Handed Over | 同 Deactivated 处理。 |
| -3 | Settled | 隐藏该行，已结算。 |
| -4 | Cancelled | 隐藏该行，已取消。 |

### 4.3. 产品类型 (Product Type)

| 产品码 | 类型名称 | UI 表现 |
| :--- | :--- | :--- |
| 1 | 滚球盘 (Live Odds) | 需在盘口卡片上标注 **"Live"** 标识。 |
| 3 | 赛前盘 (Pre-match Odds) | 默认展示，无需特殊标识。 |

---

## 5. WebSocket实时通信

平台通过 WebSocket 实现数据的实时推送，前端需监听并处理以下核心消息类型：

| 消息类型 | CMD | 功能描述 | 前端处理 |
| :--- | :--- | :--- | :--- |
| **Fixture Change** | 10010 | 比赛赛程变更通知（开始时间更新、取消等）。 | 更新比赛列表和详情页的比赛信息。 |
| **Odds Change** | 10020 | 赔率变化通知，包含部分或全部盘口的最新赔率。 | 实时更新盘口卡片中的赔率，并提供视觉反馈（如赔率上涨/下跌动画）。 |
| **Alive** | 10000 | UOF 心跳消息。 | 若 `offset_time > 20`，表示服务异常，需暂停所有投注功能并提示用户。 |
| **BetStop** | 10030 | 停止投注通知。 | 根据 `groups` 字段暂停对应盘口的投注功能（显示赔率但按钮置灰）。 |
| **BetCancel** | 10050 | 取消投注通知。 | 隐藏对应的 specifier 行或显示取消状态。 |
| **Match Status** | 10060 | 比赛状态变更通知。 | 更新比赛状态显示和可投注状态。 |

---

## 6. API集成策略

### 6.1. API域名配置

**主API服务域名**: `https://xpbet-service-api.helix.city`

所有RESTful API请求应使用此域名作为基础URL。建议在项目中通过环境变量进行配置管理,详细配置信息请参考 [config/api.config.md](../../config/api.config.md)。

**WebSocket服务域名**: `wss://xpbet-ws-api.helix.city/ws`

用于实时数据推送,包括赔率变化、比赛状态更新等。

### 6.2. API接口集成

为确保前端与后端API的顺畅协作,特制定以下集成策略:

| 场景 | 接口 | 关键参数/说明 |
| :--- | :--- | :--- |
| **应用初始化** | `/v1/menu/sports` | 加载体育项目列表。 |
| **用户选择体育项目** | `/v1/menu/category` | `sport_id` - 加载赛区和热门联赛。 |
| **用户选择赛区** | `/v1/menu/tournament` | `cate_id` - 加载联赛列表。 |
| **用户选择联赛** | `/v1/match` | `tournament_id` - 加载比赛列表。**注意：获取数据后立即清空 `markets` 字段以释放内存。** |
| **用户进入比赛详情** | `/v1/match/{match_id}` | `match_id` - 获取比赛头部信息。 |
| **加载比赛盘口** | `/v1/match/row/{match_id}` | `match_id` - 获取完整的盘口数据。 |
| **分页加载盘口** | `/v1/match/{match_id}/market` | `cursor`, `limit` - 分页获取盘口数据。 |
| **实时数据更新** | `wss://xpbet-ws-api.helix.city/ws` | 监听各类消息，实时更新UI。 |

---

## 7. 参考资料

- [1] 体育盘口Tab&Chip分类规则文档.md
- [2] 体育博彩平台盘口交互设计方案.md
- [3] UOF首页API文档.docx
